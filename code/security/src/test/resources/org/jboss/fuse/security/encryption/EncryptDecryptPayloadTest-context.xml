<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xmlns:cxf="http://camel.apache.org/schema/cxf"
       xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
    http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd">

    <!--  key store configuration -->
    <camel:keyStoreParameters id="keyStoreParams" type="jks"
                              resource="org/jboss/fuse/security/encryption/recipient.ks" password="password"/>

    <!--  trust store configuration -->
    <camel:keyStoreParameters id="trustStoreParams" type="jks"
                              resource="/Users/chmoulli/RedHat/GPE/GPE-Courses/fuse-integration-advanced/code/security/src/test/resources/org/jboss/fuse/security/encryption/sender.ts" password="password"/>

    <bean id="marshallSecuredXML" class="org.apache.camel.model.dataformat.XMLSecurityDataFormat">
        <property name="secureTag" value=""/>
        <property name="secureTagContents" value="true"/>
        <property name="xmlCipherAlgorithm" value="http://www.w3.org/2001/04/xmlenc#aes128-cbc"/>
        <property name="keyCipherAlgorithm" value="http://www.w3.org/2001/04/xmlenc#rsa-1_5"/>
        <property name="recipientKeyAlias" value="recipient"/>
        <property name="keyOrTrustStoreParametersId" value="trustStoreParams"/>
        <property name="namespaces">
            <map>
                <entry key="cheese" value="http://cheese.xmlsecurity.camel.apache.org/"/>
            </map>
        </property>

    </bean>

    <bean id="unmarshallSecuredXML" class="org.apache.camel.model.dataformat.XMLSecurityDataFormat">
        <property name="secureTag" value=""/>
        <property name="secureTagContents" value="true"/>
        <property name="xmlCipherAlgorithm" value="http://www.w3.org/2001/04/xmlenc#aes128-cbc"/>
        <property name="keyCipherAlgorithm" value="http://www.w3.org/2001/04/xmlenc#rsa-1_5"/>
        <property name="recipientKeyAlias" value="recipient"/>
        <property name="keyOrTrustStoreParametersId" value="keyStoreParams"/>
        <property name="namespaces">
            <map>
                <entry key="cheese" value="http://cheese.security.fuse.jboss.org/"/>
            </map>
        </property>
    </bean>

    <bean id="utils" class="org.jboss.fuse.security.encryption.Utils"/>
    <bean id="service" class="org.jboss.fuse.security.encryption.CheeseProcessImpl"/>

    <cxf:cxfEndpoint id="cheeseServiceBean"
                     address="http://localhost:9001/camel/CheeseService"
                     wsdlURL="src/test/resources/org/jboss/fuse/security/encryption/CheeseProcess.wsdl"
                     serviceClass="org.jboss.fuse.security.encryption.CheeseProcess"
                     loggingFeatureEnabled="true">
        <cxf:properties>
            <entry key="dataFormat" value="MESSAGE"/>
        </cxf:properties>
    </cxf:cxfEndpoint>

    <camelContext id="camel-encrypt" xmlns="http://camel.apache.org/schema/spring">

        <route>
            <from uri="direct://encrypt"/>
            <marshal ref="marshallSecuredXML"/>
            <to uri="mock:encrypted"/>
        </route>

        <route>
            <from uri="direct://decrypt"/>
            <unmarshal ref="unmarshallSecuredXML"/>
            <to uri="mock://decrypted"/>
        </route>

        <route streamCache="true">
            <from uri="cxf:bean:cheeseServiceBean"/>
            <log message="XML Payload : ${body}"/>
            <!--<bean ref="utils" method="convertToDom"/>
            <marshal ref="marshallSecuredXML"/>-->
            <to uri="direct://encrypt"/>
            <log message=">> Encrypted : ${body}"/>
        </route>
    </camelContext>

</beans>